{% extends 'base.html' %}

{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.js"></script>
{% endblock %}

{% block scripts %}
    <script>
        async function check_barcode_entry() {
            let input_field_value = document.getElementById('id_barcode_input').value;
            const csrftoken = Cookies.get('csrftoken');

            fetch('{% url 'check_scanned_barcode' %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    'text': 'My Foobar',
                    'barcode': input_field_value,
                }),
            }).then(response => {
                let result = response.json();
                let status_code = response.status;

                if (status_code !== 200) {
                    console.log('Error in checking barcode in db');
                    return false;
                }

                return result
            }).then(result => {
                console.log(result);
                if (result['exists'] === false) {
                    let initial_input_div = document.getElementById('id_initial_scan_input');
                    let new_input_div = document.getElementById('id_new_item_div');
                    let new_barcode_input = document.getElementById('id_new_barcode_nbr');

                    initial_input_div.style.display = 'none';
                    new_input_div.style.display = 'block';
                    new_barcode_input.value = input_field_value;
                } else {

                }

            }).catch(error => {
                console.log(error)
            })
        }

        function add_new_barcode(barcode_nbr) {

        }
    </script>
{% endblock %}

{% block content %}

    <div id="id_initial_scan_input" class="m-4 mx-auto p-4 rounded-xl shadow-2xl bg-gray-50 w-4/5" style="display: block">
        <h2 class="text-2xl">Scan Barcode</h2>
        <label for="id_barcode_input">Barcode: </label>
        <input id="id_barcode_input"
               class="shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        <br><br>
        <button onclick="check_barcode_entry()"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg">
            Enter Barcode
        </button>
        <br><br>
    </div>
    <hr>

    <div id="id_new_item_div" style="display: none"
         class="m-4 mx-auto p-4 rounded-xl shadow-2xl bg-gray-50 w-4/5">
        <h2 class="text-2xl">New Item Scanned</h2>
        <br>
        <p class="mb-2">As this item has not been scanned by you before, please fill in the quantity and optionally a description of
            it.</p>
        <label for="id_new_barcode_nbr" class="my-2">Barcode: </label><input id="id_new_barcode_nbr" type="text" class="my-2 rounded">
        <br>
        <label for="id_new_barcode_desc">Description: </label><input id="id_new_barcode_desc" type="number"
                                                                 class="rounded my-4">
        <br>
        <label for="id_new_barcode_qty">Quantity: </label><input id="id_new_barcode_qty" type="number"
                                                                 class="rounded my-4">
        <br>
        <button onclick="add_new_barcode()"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded shadow-lg m-4">
            Submit
        </button>
    </div>
    <div id="id_confirm_item_div">

    </div>
{% endblock %}